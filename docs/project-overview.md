<!-- Generated by Graft | model=bedrock-claude-v4.5-sonnet-us | sig=42409f7cd7e3c3993aa75a27f7a524079a4a384966f5a22c313daae841b3841c | rev=4300e70 | 2025-11-04 -->
# Graft Project Overview

## What is Graft?

Graft is an LLM-powered documentation pipeline that generates and maintains Markdown documents from Markdown prompts. It combines DVC (Data Version Control) with AWS Bedrock's Claude Sonnet 4.5 to create a smart documentation system that understands what changed and regenerates only what's necessary.

Unlike static site generators or simple template systems, Graft tracks dependencies between documents and their sources, automatically determining whether content needs regeneration, tone adjustments, or complete rewrites based on what changed in your git repository.

## Key concepts

**Change detection**: Graft analyzes git history to determine what changed. It distinguishes between source file changes (content updates) and prompt file changes (tone/structure updates), applying different strategies for each.

**Actions**: Every document generation follows one of five actions:
- **GENERATE**: Create a new document from scratch
- **UPDATE**: Apply semantic changes from updated source files while preserving style
- **RESTYLE**: Rewrite the entire document with new tone/structure but same sources
- **REFRESH**: Both sources and style changed - full regeneration
- **MAINTAIN**: Nothing changed - output unchanged

**Multi-level DAGs**: Documents can depend on other generated documents, creating chains of documentation. A change to foundational docs ripples through dependent documents automatically.

**Auto-generated dvc.yaml**: You define dependencies in prompt frontmatter. Graft generates the DVC pipeline configuration automatically, managing the execution graph and change detection.

## Quick start

**Prerequisites**: Docker, AWS Bedrock access, git repository

**Installation**:
```bash
git clone <graft-repo>
cd graft
make build
```

**Set up your project**:
```bash
cd /your/project
ln -s /path/to/graft/bin/graft bin/graft
cp /path/to/graft/.env.example .env
# Edit .env with AWS credentials
bin/graft init
```

**Create your first document**:
```bash
bin/graft new executive-summary strategy
```

Edit `docs/strategy/executive-summary.prompt.md`:
```yaml
---
deps:
  - docs/strategy/foundations.md
  - docs/metrics/q4-results.md
model: bedrock-claude-v4.5-sonnet-us
---

Create an executive summary combining our strategic foundations with Q4 results.
Focus on key insights and actionable recommendations.
```

**Generate**:
```bash
bin/graft rebuild
```

Output appears in `docs/strategy/executive-summary.md`.

## Common workflows

**Adding documents**: Use `bin/graft new <name> [topic]` to scaffold templates, then edit dependencies and instructions before running `rebuild`.

**Iterating on content**: Edit source files and run `bin/graft rebuild`. Only affected documents regenerate. Use `bin/graft status` to see what will change before running.

**Refining tone**: Edit the prompt instructions in `.prompt.md` files. This triggers a RESTYLE action that rewrites the entire document with new tone while preserving semantic content.

**Understanding impact**: Before editing a widely-used source file, run `bin/graft uses <file>` to see which documents depend on it. After changes, `bin/graft status` shows what needs regeneration.

**Debugging output**: Use `bin/graft diff <stage_name>` to view the exact packed prompt context sent to the LLM, including all dependencies and instructions.

**Hierarchical documentation**: Create foundation documents first, then reference them in dependent documents. For example:
```
docs/foundations.md → docs/strategy.prompt.md → docs/tactics.prompt.md
```

Changes to foundations automatically propagate through the chain.

## Configuration essentials

**AWS credentials** (`.env` file):
```bash
AWS_ACCESS_KEY_ID=***
AWS_SECRET_ACCESS_KEY=***
AWS_DEFAULT_REGION=us-east-1
```

**Model selection** (in prompt frontmatter):
```yaml
model: bedrock-claude-v4.5-sonnet-us  # Default, recommended
# OR
model: bedrock-claude-sonnet-4-us      # Alternative
```

**Dependencies** (in prompt frontmatter):
```yaml
deps:
  - docs/sources/file1.md
  - docs/sources/file2.md
  - docs/generated/other-doc.md  # Can depend on generated docs
```

Paths are relative to project root. Only files listed in `deps:` trigger regeneration when changed. See [configuration.md](configuration.md) for complete options.

## Troubleshooting highlights

**Documents not regenerating**: Check `bin/graft status`. If everything shows "up to date", the files in your `deps:` list haven't changed. To force regeneration due to prompt instruction changes, touch the `.prompt.md` file.

**AWS authentication errors**: Verify `.env` file exists with correct credentials. Test directly: `docker run --rm --env-file .env graft:local llm -m bedrock-claude-v4.5-sonnet-us "test"`

**Image not found**: Run `make build` in the Graft directory to build the `graft:local` Docker image. Use `DOCFLOW_DIR=/path/to/graft` to specify custom location.

**Large diffs in generated content**: Review the packed prompt with `bin/graft diff <stage>`. Ensure your prompt includes specific instructions about formatting and tells the LLM to "keep formatting, headings, and unchanged sections identical."

See [troubleshooting.md](troubleshooting.md) for additional issues and solutions.

## This document itself

This overview was generated by Graft from the source documents in the `docs/` directory: getting-started.md, how-it-works.md, command-reference.md, configuration.md, and troubleshooting.md. It demonstrates Graft's ability to synthesize multiple source files into a coherent, focused document that provides value beyond simple concatenation.
