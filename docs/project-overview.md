<!-- Generated by Graft | model=bedrock-claude-v4.5-sonnet-us | sig=a7a7ac36d2e1cc3c4a17921ba3eab99a3d531489d77a16d4878385a4ca6c5825 | rev=39b5c7a | 2025-11-04 -->
# Graft Project Overview

## What is Graft?

Graft is an intelligent documentation system that generates and maintains Markdown documents using Claude AI. Unlike traditional static site generators, Graft treats documentation as a build artifact—it tracks source files and prompt instructions, detects what changed, and automatically applies precise updates. This creates a workflow where you focus on source content and desired output style, while Graft handles the synthesis and maintenance.

The core value: documentation that stays fresh without manual rewriting. Change a source file, and Graft updates only the affected sections. Refine your prompt instructions, and Graft regenerates the entire document with new tone or structure. The system knows the difference.

## Key concepts

### Change detection

Graft distinguishes between two types of changes:

- **Source changes**: Modified content files that should be incorporated semantically
- **Prompt changes**: New instructions that require regenerating the document with different style, tone, or structure

This distinction enables surgical updates when sources change, and complete rewrites when you want a different presentation.

### Actions

Based on change detection, Graft determines the appropriate action:

- **GENERATE** - No previous draft exists → create document from scratch
- **UPDATE** - Sources changed, prompt unchanged → apply semantic changes only, preserving unchanged sections byte-for-byte
- **RESTYLE** - Prompt changed, sources unchanged → regenerate entire document with new instructions
- **REFRESH** - Both changed → apply source updates AND new instructions
- **MAINTAIN** - Nothing changed → keep document unchanged

These directives are passed to Claude with precise context about what changed, enabling intelligent document evolution.

### Multi-level DAGs

Graft supports dependency hierarchies:

- Documents can depend on other generated documents
- Creates directed acyclic graphs (DAGs) of documentation
- Enables complex workflows: summaries of summaries, cross-document synthesis, progressive abstraction

### Auto-generated dvc.yaml

Graft automatically generates DVC pipeline definitions from your document configurations. You define dependencies in document frontmatter; Graft handles the orchestration. This provides:

- Reproducible builds
- Change tracking
- Dependency resolution
- Parallel execution where possible

## Quick start

### Prerequisites

- Docker installed
- AWS account with Claude access (Bedrock)
- Git repository for your documentation

### Installation

```bash
# Clone Graft
git clone https://github.com/yourorg/graft.git
cd graft

# Build the Docker image
bin/graft build
```

### AWS credentials setup

Graft supports multiple authentication methods:

1. **AWS directory mount** (recommended): Your `~/.aws` directory is automatically mounted, supporting profiles and SSO sessions
2. **Environment variables**: Create `.env` file with `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_REGION`
3. **Container environment**: Variables passed through from host

### Creating your first document

```bash
cd ../your-project

# Initialize graft
../graft/bin/graft init

# Create a document configuration
mkdir -p docs/strategy
cat > docs/strategy/executive-summary.md.yaml << 'EOF'
sources:
  - roadmap.md
  - technical-specs.md
prompt: |
  Create an executive summary that synthesizes the roadmap and technical 
  specifications. Focus on business value and strategic direction. Keep it 
  under 500 words.
EOF

# Generate the document
../graft/bin/graft rebuild
```

The generated document appears at `docs/strategy/executive-summary.md`.

### Basic iteration workflow

```bash
# Edit source files to add content
vim roadmap.md

# Rebuild (applies UPDATE - incorporates new content only)
../graft/bin/graft rebuild

# Change the prompt to adjust tone/structure
vim docs/strategy/executive-summary.md.yaml

# Rebuild (triggers full regeneration with new instructions)
../graft/bin/graft rebuild
```

Graft automatically detects what changed and applies the appropriate action.

## Common workflows

### Day-to-day usage

```bash
# Check what's out of date
../graft/bin/graft status

# Rebuild changed documents
../graft/bin/graft rebuild

# Rebuild everything from scratch
../graft/bin/graft rebuild --force
```

### Iterating on documents

The system distinguishes between:

- **Content refinement**: Edit source files → run `rebuild` → triggers UPDATE (semantic changes only)
- **Style refinement**: Edit prompt instructions → run `rebuild` → triggers full regeneration

This means you can safely iterate on content without losing manual polish, then switch to style iteration when needed.

### Documentation hierarchies

Create multi-level documentation by using generated documents as sources:

```yaml
# docs/leadership/quarterly-report.md.yaml
sources:
  - docs/strategy/executive-summary.md  # Generated document
  - financials/q4-results.csv
  - team/okr-status.md
prompt: |
  Create a quarterly report for leadership combining the executive summary,
  financial results, and OKR status. Focus on outcomes and next quarter priorities.
```

Graft resolves dependencies automatically and rebuilds in correct order.

## Configuration essentials

### AWS credentials

Three methods (in order of preference):

1. **AWS directory mount**: `~/.aws` automatically mounted (profiles, SSO, credential files)
2. **Environment variables**: Set in `.env` file
3. **Container environment**: Variables from host

### Model selection

Configure in document YAML:

```yaml
model: anthropic.claude-3-5-sonnet-20241022-v2:0  # Default, recommended
# or
model: anthropic.claude-3-opus-20240229-v1:0      # More capable, slower
```

### Dependency specification

```yaml
sources:
  - path/to/source.md           # Simple path
  - other/document.md.yaml      # Generated document (auto-resolved)
  - data/file.json              # Any text format
```

For complete configuration reference, see [configuration.md](configuration.md).

## Troubleshooting highlights

### "No module named 'graft'"

The container isn't finding the Graft code. Ensure you're running commands through `bin/graft`, which handles the Docker mount correctly.

### AWS authentication failures

Check in order:
1. Is `~/.aws` directory accessible? (Permissions)
2. Are environment variables set correctly in `.env`?
3. Do you have Bedrock access enabled in your AWS account?
4. Is the AWS region correct? (`us-west-2` recommended for Claude access)

### Documents not rebuilding when sources change

Run `bin/graft rebuild --force` to clear caches. If the issue persists, check that source paths in YAML configurations are correct relative to the project root.

### "Rate limit exceeded"

Claude API has rate limits. Wait a few moments and retry. For large documentation sets, consider:
- Rebuilding subsets with `dvc repro <specific-target>`
- Spacing out rebuilds during development
- Using `--downstream` flag to rebuild only affected documents

For more troubleshooting guidance, see [troubleshooting.md](troubleshooting.md).

---

## This document itself

This overview was generated by Graft from the project's source documentation: `docs/configuration.md`, `docs/getting-started.md`, and `docs/how-it-works.md`. The style prompt instructed Graft to synthesize a comprehensive project introduction with specific sections and information density. This demonstrates Graft's capability to transform multiple source documents into cohesive, purpose-built documentation—exactly the workflow it's designed to enable for your projects.
