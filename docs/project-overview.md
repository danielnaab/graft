<!-- Generated by Graft | model=bedrock-claude-v4.5-sonnet-us | sig=780f5953ce5a89f267505353ba342f49d37548c5b5e116cf88659538d819b23d | rev=9488421 | 2025-11-04 -->
# Graft Project Overview

## What is Graft?

Graft is an LLM-powered documentation pipeline that generates and maintains Markdown documents from Markdown prompts. It combines git-based change detection with DVC pipeline management to intelligently update documentation as source materials evolve.

The core value proposition: write documentation instructions once, then let Graft automatically regenerate affected documents when dependencies change—applying only semantic updates when sources change, or complete rewrites when instructions change.

Graft uses Claude Sonnet 4.5 via AWS Bedrock to generate high-quality documentation, with DVC managing multi-level documentation hierarchies efficiently.

## Key concepts

### Change detection

Graft tracks two types of changes through git history:

**Source changes**: When files listed in `deps:` frontmatter are modified, the system compares versions and includes only changed sections in the packed prompt, instructing Claude to update only affected content.

**Prompt changes**: When prompt instructions are modified, the system detects this by hashing the prompt body and triggers a complete regeneration with the new instructions.

### Actions

Based on what changed, Graft determines the appropriate action:

- **GENERATE** - No previous draft exists → create document from scratch
- **UPDATE** - Sources changed, prompt unchanged → apply semantic changes only, keep rest identical
- **RESTYLE** - Prompt changed, sources unchanged → regenerate entire document with new instructions
- **REFRESH** - Both changed → apply source updates AND new instructions
- **MAINTAIN** - Nothing changed → keep document unchanged

These directives are passed to Claude, which applies them intelligently to minimize unnecessary changes.

### Multi-level documentation DAGs

Generated documents can serve as inputs to other prompts, creating documentation hierarchies:

```
sources/strategy.md (manual)
  └─> explorations/analysis.md (generated)
      └─> frameworks/technical.md (generated)
          └─> artifacts/brief.md (generated)
```

DVC manages this efficiently with `cache: false` for outputs—files are git-tracked without cache duplication, and changes cascade through the dependency graph automatically.

### Auto-generated dvc.yaml

The DVC pipeline configuration is generated automatically by scanning all `*.prompt.md` files. Each prompt becomes a stage with dependencies from frontmatter and co-located output. A pre-commit hook ensures `dvc.yaml` stays synchronized with prompt files.

## Quick start

### Prerequisites

- Docker
- AWS credentials with Bedrock access to Claude Sonnet 4.5

### Installation

```bash
# Build graft
git clone <graft-repo>
cd graft
make build

# Set up your project
cd ../your-project

# Configure AWS credentials (choose one):
# Method 1 (recommended): Use your existing ~/.aws configuration
#   - Graft automatically mounts ~/.aws for profiles and SSO
# Method 2: Use environment variables
cp .env.example .env
# Edit .env: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION

# Initialize graft
bin/graft init
```

### Create your first document

```bash
# Scaffold a new prompt
bin/graft new executive-summary strategy

# Edit docs/strategy/executive-summary.prompt.md
# Add dependencies and instructions:
---
deps:
  - docs/strategy/foundations.md
  - docs/strategy/market-analysis.md
---

Create an executive summary that synthesizes the strategic foundations 
and market analysis. Focus on key insights and actionable recommendations.

# Generate the document
bin/graft rebuild
```

View the result at `docs/strategy/executive-summary.md`.

### Basic workflow

To refine generated documents:

1. **Edit source files** → Run `bin/graft rebuild` → Triggers UPDATE (incorporates new content only)
2. **Edit prompt instructions** → Run `bin/graft rebuild` → Triggers RESTYLE (full regeneration)
3. **Check what will regenerate** → Run `bin/graft status` → Shows which stages need to run

The system automatically detects what changed and applies appropriate updates.

## Common workflows

### Add a new document

```bash
bin/graft new report analysis
# Edit docs/analysis/report.prompt.md with deps and instructions
bin/graft rebuild
```

### Update dependencies

Edit the `deps:` list in prompt frontmatter, then run `bin/graft rebuild`. The system regenerates affected documents.

### Change prompt tone or structure

Edit prompt instructions directly—this triggers a RESTYLE action that regenerates the entire document with new instructions while preserving source content.

### Build documentation hierarchies

Use generated documents as inputs to other prompts:

```yaml
---
deps:
  - docs/analysis/market.md        # Generated doc
  - docs/strategy/foundations.md   # Manual source
---

Create an executive brief synthesizing market analysis and strategic foundations.
```

DVC handles the dependency graph automatically—changes cascade through all affected documents.

### Debug generation

```bash
# View the packed prompt context
bin/graft diff executive_summary

# Check which prompts depend on a file
bin/graft uses docs/strategy/foundations.md

# Check pipeline status
bin/graft status
```

## Configuration essentials

### AWS credentials

Graft supports multiple authentication methods:

1. **AWS directory mount** (recommended): Your `~/.aws` directory is automatically mounted for profiles and SSO
2. **Environment variables**: Set via `.env` file: `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_REGION`

### Model selection

Default model: `bedrock-claude-v4.5-sonnet-us`

Specify in frontmatter:

```yaml
---
model: bedrock-claude-v4.5-sonnet-us
deps: [...]
---
```

Available models include Claude Sonnet 4.5, 4, 3.5, and Haiku 3. Use US inference profiles (`-us` suffix) for cross-region routing and higher throughput.

### Dependency specification

List source files in frontmatter:

```yaml
---
deps:
  - docs/strategy/foundations.md    # Manual source
  - docs/analysis/market.md         # Generated doc as input
  - ../external/research.md         # Outside docs/
---
```

Paths are relative to repo root. Changes to any dependency trigger regeneration.

For complete configuration options, see [configuration.md](docs/configuration.md).

## Troubleshooting highlights

### Nothing regenerated

Check `bin/graft status` to see pipeline state. The system only regenerates when files in `deps:` change. To force regeneration: `touch docs/your-doc.prompt.md && bin/graft rebuild`.

### AWS authentication errors

Verify credentials in `.env` file include `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, and `AWS_REGION`. Test Bedrock access directly:

```bash
docker run --rm --env-file .env graft:local \
  llm -m bedrock-claude-v4.5-sonnet-us "test"
```

Check IAM permissions (`bedrock:InvokeModel`) and verify model access in Bedrock console.

### Large diffs in generated docs

Ensure prompts instruct preservation: "Edit only where diffs imply semantic changes. Keep existing content unchanged if sources unchanged." Review packed prompt with `bin/graft diff <stage>` to verify UPDATE action (not RESTYLE).

### Docker image not found

Run `make build` in the graft directory to build `graft:local` image.

For additional troubleshooting, see [troubleshooting.md](docs/troubleshooting.md).

## This document itself

This overview was generated by Graft from the project's source documentation files: getting-started.md, how-it-works.md, configuration.md, command-reference.md, and troubleshooting.md. It demonstrates Graft's capability to synthesize multiple sources into coherent, focused documentation that serves a specific purpose—in this case, providing a comprehensive project introduction.
