<!-- Generated by Docflow | model=bedrock-claude-v4.5-sonnet-us | sig=1e0f4734ba5a03333254049fcab9deddffc3a28916d58eabb83266275dd3a72c | rev=74bc6ad | 2025-11-03 -->
# Docflow Overview

Docflow is a documentation generation system that uses AI to create and maintain Markdown documents from source files. It combines DVC (Data Version Control) for dependency tracking with Claude AI models via AWS Bedrock to intelligently regenerate only what's needed when sources or prompts change.

## What is docflow?

Docflow treats documentation as a data pipeline. You write prompts that reference source files (like code, specs, or other docs), and docflow generates target documents using Claude AI. When sources change, only affected documents regenerate. When you refine a prompt's instructions, docflow rewrites the document in the new style. This keeps documentation synchronized with sources while minimizing unnecessary AI calls and costs.

The system runs in Docker and CI, making it reproducible and easy to integrate into existing workflows.

## Key concepts

**Change detection** - Docflow analyzes what changed between runs:
- Source file content modifications
- Prompt instruction edits  
- Both, or neither

**Actions** - Based on what changed, docflow takes one of five actions:
- **GENERATE** - Create a new document (first run)
- **UPDATE** - Sources changed, apply semantic updates only
- **RESTYLE** - Prompt changed, rewrite entire document in new style
- **REFRESH** - Both changed, update content AND restyle
- **MAINTAIN** - Nothing changed, keep document identical

**Multi-level DAGs** - Documents can depend on other generated documents, creating hierarchies. Docflow builds a dependency graph and generates in the correct order.

**Auto-generated dvc.yaml** - You never write DVC pipeline configs manually. Docflow scans your `.prompt.md` files, extracts dependencies from frontmatter, and generates the complete `dvc.yaml` automatically.

## Quick start

**Prerequisites:**
- Docker and Docker Compose
- AWS account with Bedrock access
- Claude models enabled in us-east-1

**Installation:**

```bash
git clone <repository>
cd docflow
cp .env.example .env
# Edit .env with your AWS credentials
```

**Create your first document:**

1. Create a prompt file at `docs/summary.prompt.md`:

```yaml
---
deps:
  - README.md
  - docs/architecture.md
---

Create a brief project summary from the README and architecture docs.
Focus on the core value proposition and key technical decisions.
```

2. Generate the document:

```bash
docker compose run --rm docflow
```

3. Find your generated document at `docs/summary.md`

**Basic workflow:**

```bash
# Generate all documents
docker compose run --rm docflow

# Check what would regenerate (dry run)
docker compose run --rm docflow dvc dag

# Commit generated docs
git add docs/*.md .dvc/
git commit -m "Update documentation"
```

## Common workflows

**Daily documentation maintenance:**

```bash
# After changing source files
docker compose run --rm docflow
git add docs/ .dvc/
git commit -m "Regenerate docs after source updates"
```

**Iterating on a document:**

1. Edit the `.prompt.md` file to refine instructions
2. Run `docker compose run --rm docflow`
3. Review the regenerated document
4. Repeat until satisfied

Docflow detects prompt changes and triggers a RESTYLE action, rewriting the entire document.

**Building documentation hierarchies:**

```yaml
# docs/overview.prompt.md - depends on sources
---
deps:
  - docs/api.md
  - docs/architecture.md
---

# docs/handbook.prompt.md - depends on generated docs
---
deps:
  - docs/overview.md
  - docs/getting-started.md
---
```

Docflow generates in dependency order automatically.

**CI integration:**

```yaml
# .github/workflows/docs.yml
- name: Generate documentation
  run: docker compose run --rm docflow
  env:
    AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
    AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    AWS_REGION: us-east-1
```

## Configuration essentials

**AWS credentials** - Set in `.env` file:

```bash
AWS_ACCESS_KEY_ID=***
AWS_SECRET_ACCESS_KEY=***
AWS_REGION=us-east-1
AWS_DEFAULT_REGION=us-east-1
```

**Model selection** - Specify in frontmatter:

```yaml
---
model: bedrock-claude-v4.5-sonnet-us  # Recommended
deps: [...]
---
```

Available models:
- `bedrock-claude-v4.5-sonnet-us` - Latest, most capable (recommended)
- `bedrock-claude-v4-sonnet-us` - Claude Sonnet 4
- `bedrock-claude-v3.5-sonnet` - Claude Sonnet 3.5
- `bedrock-claude-v3-haiku` - Faster, less capable

Use `-us` suffix models for cross-region routing and higher throughput.

**Dependencies** - The only required frontmatter field:

```yaml
---
deps:
  - docs/source1.md
  - docs/source2.md
  - docs/generated.md  # Can depend on other generated docs
---
```

Docflow does not currently expose model parameters (temperature, top_p, max_tokens). Models use their defaults, which work well for documentation. To influence output style, adjust your prompt instructions directly.

See [configuration.md](configuration.md) for complete reference.

## Troubleshooting highlights

**"Model not found" error:**

Ensure Claude models are enabled in your AWS Bedrock console for us-east-1. Check the AWS Bedrock console > Model access > Manage model access > Enable Anthropic models.

**Documents regenerating unnecessarily:**

Check `git status` - unstaged changes to source files trigger regeneration. Commit or stash changes to see what actually needs updating. Also verify your `.gitignore` excludes DVC cache directories.

**Changes not being detected:**

Run `dvc status` to see what DVC thinks changed. If a source file changed but docflow didn't regenerate, verify the dependency is listed in `deps:` frontmatter and you ran `scripts/generate_dvc_yaml.py` to rebuild the pipeline.

**Inconsistent updates to existing documents:**

When requesting UPDATE actions, emphasize preservation in your prompt:

```yaml
---
deps: [...]
---

When updating this document, preserve existing structure and wording.
Only modify sections where source diffs indicate substantive changes.
Keep formatting, headings, and unchanged sections identical.
```

See [troubleshooting.md](troubleshooting.md) for comprehensive debugging guidance.

## This document itself

This overview was generated by docflow from the project's source documentation (configuration.md, troubleshooting.md, and other docs referenced in the prompt). It demonstrates how docflow synthesizes multiple sources into coherent, focused documentation while maintaining consistency and reducing manual maintenance overhead.
