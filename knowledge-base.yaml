apiVersion: kb/v1
name: graft
description: "Implementation knowledge base for Graft - development guides, code structure, and implementation documentation"

entrypoints:
  human: docs/README.md
  agent: AGENTS.md

meta:
  entrypoint: ".graft/meta-knowledge-base/AGENTS.md"

imports:
  - kind: local
    path: ../meta-knowledge-base
    entrypoint: meta.yaml
  - kind: local
    path: ../python-starter
    entrypoint: knowledge-base.yaml
  - kind: local
    path: ../rust-starter
    entrypoint: knowledge-base.yaml
  - kind: local
    path: ../living-specifications
    entrypoint: knowledge-base.yaml
  - kind: local
    path: ../software-factory
    entrypoint: knowledge-base.yaml

components:
  - name: graft-common
    path: crates/graft-common
    note: "Shared infrastructure (command execution, git ops, state types, config parsing)"
  - name: graft
    path: crates/graft-cli
    note: "Graft semantic dependency manager (Rust implementation, primary)"
  - name: graft-python
    path: src/graft
    note: "Graft Python implementation (deprecated, maintained for compatibility)"
  - name: grove
    path: crates/grove-cli
    note: "Grove multi-repo workspace manager (Rust implementation)"

paths:
  docs: docs
  notes: notes
  specifications: docs/specifications
  grove_docs: docs/grove
  grove_specs: docs/specifications/grove

conventions:
  architecture: "Clean architecture with Protocol-based DI (Python), trait-based boundaries (Rust)"
  testing: "Fakes over mocks; unit tests for services, integration tests for workflows"
  documentation: "Plain language, no emojis, professional tone per meta-KB style policy"
  domain-models: "Frozen dataclasses (Python), newtype pattern (Rust)"

sources:
  canonical:
    - path: "docs/specifications/architecture.md"
      note: "Architecture decisions and system design"
    - path: "docs/specifications/decisions/**"
      note: "Specification-level ADRs (0001-0007)"
    - path: "docs/specifications/graft/**"
      note: "All graft format and operation specifications"
    - path: "docs/specifications/grove/**"
      note: "Grove workspace management specifications"
    - path: "src/graft/**/*.py"
      note: "Source code is canonical for implementation details"
    - path: "crates/**/*.rs"
      note: "Rust source code is canonical for its implementation"
    - path: "docs/decisions/**"
      note: "Implementation-specific ADRs (error handling, etc.)"

  interpretation:
    - path: "docs/README.md"
      note: "Developer-friendly architecture overview, interprets specifications"
    - path: "docs/guides/**"
      note: "User guides - practical application of canonical specifications"
    - path: "docs/grove-overview.md"
      note: "Grove overview, interprets grove specifications"
    - path: "docs/grove/implementation/**"
      note: "Grove implementation docs and ADRs"
    - path: "docs/configuration.md"
      note: "Configuration examples and guidance, interprets format specs"

  tracking:
    - path: "docs/grove/planning/**"
      note: "Grove planning docs (roadmap, slices) - working documents"
    - path: "notes/**"
      note: "Time-bounded exploration and session logs"

rules:
  lifecycle:
    statuses: ["draft", "working", "stable", "deprecated"]
  provenance:
    requiredFor: ["factual-claims", "operational-guidance"]
  writes:
    allow: ["src/**", "crates/**", "tests/**", "docs/**", "notes/**"]
    deny: ["docs/specifications/**", "secrets/**", "config/prod/**"]
